import{o as f,c as w,p as V,a as N,b as r,r as g,d as te,e as J,v as oe,f as q,g as se,h as ne,i as H,F as A,j as Y,w as le,k as ae,u as C,l as u,m as v,n as x,t as b,E as G,q as P,s as X,x as $,y as k,z as ie,A as ce,B as re,C as ue,D as de,G as pe,H as _e,I as me,J as fe,K as he,L as ve,M as ge}from"./vendor-f914191f.js";(function(){const o=document.createElement("link").relList;if(o&&o.supports&&o.supports("modulepreload"))return;for(const t of document.querySelectorAll('link[rel="modulepreload"]'))s(t);new MutationObserver(t=>{for(const n of t)if(n.type==="childList")for(const a of n.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&s(a)}).observe(document,{childList:!0,subtree:!0});function l(t){const n={};return t.integrity&&(n.integrity=t.integrity),t.referrerPolicy&&(n.referrerPolicy=t.referrerPolicy),t.crossOrigin==="use-credentials"?n.credentials="include":t.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function s(t){if(t.ep)return;t.ep=!0;const n=l(t);fetch(t.href,n)}})();const E=(e,o)=>{const l=e.__vccOpts||e;for(const[s,t]of o)l[s]=t;return l},ye={},z=e=>(V("data-v-943f389e"),e=e(),N(),e),we={class:"loading"},Le=z(()=>r("div",{class:"point an-point"},null,-1)),Se=z(()=>r("div",{class:"point an-point"},null,-1)),be=z(()=>r("div",{class:"point an-point"},null,-1)),Ie=[Le,Se,be];function xe(e,o){return f(),w("div",we,Ie)}const Ce=E(ye,[["render",xe],["__scopeId","data-v-943f389e"]]);let R="";R="ws://localhost:8088/";location!=null&&location.protocol.includes("https")&&(R="wss"+R.slice(2));const B={appId:"G8CPjjcTqnNU4NjC",sessionId:"qbd4r6rahnxuazy5qoqd"};function Ee(){}setInterval(Ee,1e4);const M=e=>{const o=navigator.userAgent,l=/Chrome/.test(o)&&/Google Inc/.test(navigator.vendor),s=/Firefox/.test(o),t=/Trident/.test(o),n=/Edge/.test(o),a=/Safari/.test(o)&&/Apple Computer/.test(navigator.vendor),c=l*5+s*10+t*10+n*10+a*5||5;let i=1024*1024*c*.9;return new Blob([e]).size>i},ke=(e,o,l)=>{localStorage.setItem("token",e),localStorage.setItem("saveTokenTime",JSON.stringify(o)),localStorage.setItem("expiresIn",JSON.stringify(l))};let F;const D=()=>{const e="chatsList";return F=localStorage.getItem(e),F===null?[]:JSON.parse(F)},K=(e=[],o="chat-list")=>{Q(e);try{localStorage.setItem(o,JSON.stringify(e))}catch(l){console.error("本地存储数据时出错：",l)}},Q=(e=[])=>{const o=JSON.stringify(e);if(M(o))e.shift(),e.shift(),M(JSON.stringify(e))&&Q(e);else return},Te=()=>{if(!localStorage.getItem("token"))return!0;const e=JSON.parse(localStorage.getItem("saveTokenTime")),o=JSON.parse(localStorage.getItem("expiresIn"));return new Date().getTime()/1e3-e>o},qe=(e,o)=>{let l,s;e.addEventListener("touchstart",function(t){l=t.touches[0].clientX,s=t.touches[0].clientY}),e.addEventListener("touchmove",function(t){const n=t.touches[0].clientX-l,a=t.touches[0].clientY-s;Math.abs(n)>Math.abs(a)?n<-80?(console.log("向左滑动"),o()):console.log("向右滑动"):a<0?console.log("向上滑动"):console.log("向下滑动")}),e.addEventListener("touchend",function(t){l=null,s=null})},O=g(0),Ae=e=>(O.value++,e.then(o=>(O.value--,o))),T=D(),U=T.findIndex(e=>e==null);console.log("🚀 ~ file: websocketChat.js:20 ~ x ~ x:",U,T.length);U>0&&(T.splice(U-1,2),K(T));let j=[{role:"system",content:"You are a professional front end assistant."}];T.forEach((e,o)=>{j=[...j,{role:"user",content:e.question},{role:"assistant",content:e.rep}]});const W=[],$e=e=>{console.log("🚀 ~ file: index.js:26 ~ postOpenAi ~ request:",e,"time:"+new Date().toLocaleTimeString());let o=JSON.parse(JSON.stringify(j));W.forEach((s,t)=>{o=[...o,{role:"user",content:s.question},{role:"assistant",content:s.rep}]}),o.push({role:"user",content:e});const l=o.length;return l>=7&&o.splice(1,l-5),te.post("https://api.openai.com/v1/chat/completions",{model:"gpt-3.5-turbo-0301",messages:o,temperature:0,n:1,user:"user"},{headers:{Authorization:`Bearer ${window.hhh_API_key.slice(0,-2)}`,"Content-Type":"application/json"},withCredentials:!1}).then(s=>{var a,c;let t=s.data;typeof t=="string"&&(t=JSON.parse(s.data)),console.log("🚀 ~ file: websocketChat.js:38 ~ postOpenAi ~ response:",typeof t,t);const n=(c=(a=t.choices[0])==null?void 0:a.message)==null?void 0:c.content;return o.push({role:"assistant",content:n}),n}).catch(s=>{const t=s==null?void 0:s.message;throw console.log("🚀 ~ file: index.js:75 ~ postOpenAi ~ er:",s),console.log("post api请求出错"),new Error(t)})},Z=e=>(V("data-v-83bc369f"),e=e(),N(),e),Oe={class:"chat-list"},Ve={class:"chat-item chat-item-user",style:{position:"relative"}},Ne={class:"chat-item-rep mr-10 user"},Je=Z(()=>r("div",{class:"me square"},"我",-1)),De={class:"time",style:{position:"absolute",bottom:"-25px",right:"50px"}},Be={class:"chat-item",style:{position:"relative"}},Fe=Z(()=>r("div",{class:"square"},"ai",-1)),Re={class:"chat-item-rep ml-10"},Ue={class:"time",style:{position:"absolute",bottom:"-25px",left:"50px"}},je={class:"submit-bottom"},Pe=J({__name:"ChatComponent",emits:["JLogin"],setup(e,{emit:o}){o("JLogin");const l=localStorage.getItem("sessionId");l?B.sessionId=l:(B.sessionId=oe(),localStorage.setItem("sessionId",B.sessionId));const s=g("");let t=g(0),n=g([]);const a=q([]),c=g(null),i=g(null),h=()=>{let y="",m=s.value;const p=q({question:"",questionTime:"",rep:"",repTime:""});if(p.question=s.value,p.questionTime=new Date().toLocaleString(),s.value="",!m.trim())return;t.value=1,n.value=[...n.value,m,y],a.push(p);const I=$e(p.question);Ae(I).then(S=>{console.log("🚀 ~ file: ChatComponent.vue:42 ~ postOpenAi ~ res:",S),n.value[n.value.length-1]=S,p.rep=S,p.repTime=new Date().toLocaleString(),W.push(p),console.log("🚀 ~ file: ChatComponent.vue:59 ~ useActionRequest ~ chatItem:",JSON.stringify(p)),t.value=0,G({message:"",type:"success"}),K(a,"chatsList")}),setTimeout(()=>{document.querySelector(".chat-item-scrollTo").scrollIntoView({behavior:"auto",block:"end",inline:"nearest"})})};se(()=>{a.push(...D()),console.log("🚀 ~ file: ChatComponent.vue:76 ~ onBeforeMount ~ chatsList:",a)}),ne(()=>{}),H(()=>{c.value.scrollIntoView({behavior:"auto",block:"end",inline:"nearest"});var y=document.querySelectorAll(".submit-bottom");let m=0;document.querySelector(".chat-list").addEventListener("scroll",function(d){d.target.scrollTop<m,m=d.target.scrollTop,p(d.target)&&d.preventDefault()});function p(d){for(var L=0;L<y.length;L++)if(y[L].contains(d))return!0;return!1}document.addEventListener("touchmove",function(d){if(!p(d.target)){var L=document.activeElement;(L.tagName==="INPUT"||L.tagName==="TEXTAREA")&&L.blur()}});let I=!1;const S=document.querySelector(".chat-input");S.addEventListener("compositionstart",()=>{I=!0}),S.addEventListener("compositionend",d=>{I=!1}),S.addEventListener("keydown",d=>{d.key==="Enter"&&!I&&(d.preventDefault(),h())})});const _=()=>{t.value=0};return(y,m)=>{const p=ce,I=P,S=X;return f(),w(A,null,[r("div",Oe,[(f(!0),w(A,null,Y(a,(d,L)=>(f(),w("div",{key:L},[r("div",Ve,[r("div",Ne,b(d.question),1),Je,r("div",De,[u(p,{type:"info",size:"small"},{default:v(()=>[x(b("时间:"+d.questionTime),1)]),_:2},1024)])]),r("div",Be,[Fe,r("div",Re,[d.rep?k("",!0):(f(),$(Ce,{key:0})),r("span",null,[x(b(d.rep),1),r("span",{class:ie({"rep-light-cursor":L===C(n).length-1&&C(t)===2})},null,2)])]),r("div",Ue,[u(p,{type:"info",size:"small"},{default:v(()=>[x(b("时间:"+d.repTime),1)]),_:2},1024)])])]))),128)),r("div",{class:"chat-item-scrollTo",ref_key:"scrollToDom",ref:c},null,512)]),r("div",je,[le(u(I,{type:"danger",round:"",class:"doneRep",onClick:_},{default:v(()=>[x("终止回答")]),_:1},512),[[ae,C(O)!==0]]),u(S,{ref_key:"qInoutEl",ref:i,class:"do-scrollbar-b chat-input",modelValue:s.value,"onUpdate:modelValue":m[0]||(m[0]=d=>s.value=d),autosize:{minRows:2,maxRows:4},type:"textarea",placeholder:"欢迎提问～"},null,8,["modelValue"]),u(I,{type:"primary",class:"ml-10 submit-btn",onClick:h},{default:v(()=>[x(b("提交")+" ")]),_:1})])],64)}}});const ze=E(Pe,[["__scopeId","data-v-83bc369f"]]),ee=e=>(V("data-v-5ee62532"),e=e(),N(),e),Me={class:"login-box"},He=ee(()=>r("div",{class:"login-title"}," ai chat登录 ",-1)),Ye=ee(()=>r("div",{class:"login-footer"},null,-1)),Ge=J({__name:"Login",emits:["loginSuccess"],setup(e,{emit:o}){const l=q({username:"",password:""}),s=g(),t=q({username:[{required:!0,message:"请输入用户名",trigger:"blur"}],password:[{required:!0,message:"请输入密码",trigger:"blur"}]}),n=async c=>{c&&await c.validate((i,h)=>{if(i&&l.username==="huhaibiao")return a({success:!0,data:{token:1,expiresIn:2e5}})})},a=c=>{let i="登录成功",h,_;c.success?(i="登录成功",h="success",_=1e3,ke(c.data.token,new Date().getTime()/1e3,c.data.expiresIn),o("loginSuccess")):(i=c.msg,h="error",_=3e3),G({message:i,type:h,duration:_})};return(c,i)=>{const h=X,_=re,y=P,m=ue;return f(),w("div",Me,[He,u(m,{ref_key:"ruleFormRef",ref:s,model:l,rules:t,style:{width:"100%"}},{default:v(()=>[u(_,{prop:"username"},{default:v(()=>[u(h,{modelValue:l.username,"onUpdate:modelValue":i[0]||(i[0]=p=>l.username=p),placeholder:"用户名",class:"div-box"},null,8,["modelValue"])]),_:1}),u(_,{prop:"password"},{default:v(()=>[u(h,{modelValue:l.password,"onUpdate:modelValue":i[1]||(i[1]=p=>l.password=p),type:"password",placeholder:"密码","show-password":"",class:"div-box"},null,8,["modelValue"])]),_:1}),u(y,{type:"primary",class:"div-box",onClick:i[2]||(i[2]=p=>n(s.value))},{default:v(()=>[x("登录")]),_:1})]),_:1},8,["model","rules"]),Ye])}}});const Xe=E(Ge,[["__scopeId","data-v-5ee62532"]]);const Ke=e=>(V("data-v-cc953e34"),e=e(),N(),e),Qe={key:0,class:"development"},We=Ke(()=>r("div",null,"开发环境",-1)),Ze={__name:"Developer",setup(e){const o=g("production");return(l,s)=>o.value==="development"?(f(),w("div",Qe,[We,r("div",null,"ws连接状态："+b(),1),r("div",null,"正在请求中数："+b(C(O)),1)])):k("",!0)}},et=E(Ze,[["__scopeId","data-v-cc953e34"]]),tt=J({__name:"DownLoadChatsList",setup(e){function o(s,t){const n=document.createElement("a"),a=new Blob([t]),c=URL.createObjectURL(a);n.href=c,n.download=s+".json",document.body.appendChild(n),n.click(),document.body.removeChild(n),URL.revokeObjectURL(c)}const l=s=>{const t=D();o("ai-chat-history",JSON.stringify(t))};return(s,t)=>{const n=P;return f(),$(n,{type:"primary",plain:"",onClick:l},{default:v(()=>[x("导出所有对话")]),_:1})}}}),ot=J({__name:"QuestList",emits:["change"],setup(e,{emit:o}){const l=g(D()),s=g(),t=n=>{o("change",n,l.value[n])};return(n,a)=>{const c=pe,i=_e,h=de;return f(),$(h,{modelValue:s.value,"onUpdate:modelValue":a[0]||(a[0]=_=>s.value=_),placeholder:"打开问题列表",onChange:t},{default:v(()=>[(f(!0),w(A,null,Y(l.value,(_,y)=>(f(),$(i,{class:"option",key:y,label:_.question,value:y},{default:v(()=>[u(c,{class:"box-item",effect:"dark",content:_.question,"hide-after":0,placement:"top"},{default:v(()=>[x(b(_.question),1)]),_:2},1032,["content"])]),_:2},1032,["label","value"]))),128))]),_:1},8,["modelValue"])}}});const st=E(ot,[["__scopeId","data-v-afb3f41a"]]),nt={viewBox:"0 0 1024 1024",width:"1.2em",height:"1.2em"},lt=r("path",{fill:"currentColor",d:"M926.784 480H701.312A192.512 192.512 0 0 0 544 322.688V97.216A416.064 416.064 0 0 1 926.784 480zm0 64A416.064 416.064 0 0 1 544 926.784V701.312A192.512 192.512 0 0 0 701.312 544h225.472zM97.28 544h225.472A192.512 192.512 0 0 0 480 701.312v225.472A416.064 416.064 0 0 1 97.216 544zm0-64A416.064 416.064 0 0 1 480 97.216v225.472A192.512 192.512 0 0 0 322.688 480H97.216z"},null,-1),at=[lt];function it(e,o){return f(),w("svg",nt,at)}const ct={name:"ep-HelpFilled",render:it};const rt={key:0,class:"exp-chat-list"},ut={style:{"white-space":"pre-wrap"}},dt={key:1,style:{width:"100%",height:"100%"},class:"chat-component"},pt={key:2,class:"login"},_t={__name:"App",setup(e){let o=g(!0);const l=()=>{o.value=Te()};l();const s=g({}),t=g(!1),n=(c,i)=>{s.value=i,t.value=!0},a=g(!1);return H(()=>{qe(document,()=>a.value=!0)}),(c,i)=>{const h=fe,_=he,y=ve;return f(),w(A,null,[C(o)?k("",!0):(f(),w("div",rt,[u(h,{size:30,style:{"margin-top":"10px",cursor:"pointer"},color:"#409EFC",onClick:i[0]||(i[0]=m=>a.value=!a.value)},{default:v(()=>[u(C(ct))]),_:1}),u(_,{modelValue:a.value,"onUpdate:modelValue":i[1]||(i[1]=m=>a.value=m),title:"I am the title","with-header":!1,size:"220"},{default:v(()=>[u(tt),u(st,{style:{"margin-top":"10px"},onChange:n})]),_:1},8,["modelValue"])])),u(y,{modelValue:t.value,"onUpdate:modelValue":i[2]||(i[2]=m=>t.value=m),title:s.value.question,width:"80%"},{default:v(()=>[r("div",ut,b(s.value.rep),1)]),_:1},8,["modelValue","title"]),u(et),C(o)?k("",!0):(f(),w("div",dt,[u(ze,{onJLogin:l})])),C(o)?(f(),w("div",pt,[u(Xe,{onLoginSuccess:i[3]||(i[3]=m=>me(o)?o.value=!1:o=!1)})])):k("",!0)],64)}}},mt=E(_t,[["__scopeId","data-v-1843e3fd"]]),ft=ge(mt);ft.mount("#app");window.hhh_API_key="sk-FgnukWr2hBBYdU6cQ9EKT3BlbkFJgKprcmS7ESlZ6JqP3GGshh";window.__APP_ENV__="production";console.log(window.__APP_ENV__,!1);
