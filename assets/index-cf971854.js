import{o as m,c as h,p as N,a as O,b as i,r as v,d as X,e as P,v as Z,f as q,g as ee,h as te,i as oe,F as J,j as se,w as ne,k as ae,u as b,l as _,m as L,E as z,n as F,q as M,t as x,s as G,x as k,y as E,z as re,A as le,B as ie,C as ce,D as ue}from"./vendor-1632ff21.js";(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))n(o);new MutationObserver(o=>{for(const s of o)if(s.type==="childList")for(const c of s.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&n(c)}).observe(document,{childList:!0,subtree:!0});function a(o){const s={};return o.integrity&&(s.integrity=o.integrity),o.referrerPolicy&&(s.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?s.credentials="include":o.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function n(o){if(o.ep)return;o.ep=!0;const s=a(o);fetch(o.href,s)}})();const T=(e,t)=>{const a=e.__vccOpts||e;for(const[n,o]of t)a[n]=o;return a},de={},R=e=>(N("data-v-943f389e"),e=e(),O(),e),pe={class:"loading"},_e=R(()=>i("div",{class:"point an-point"},null,-1)),me=R(()=>i("div",{class:"point an-point"},null,-1)),fe=R(()=>i("div",{class:"point an-point"},null,-1)),ge=[_e,me,fe];function he(e,t){return m(),h("div",pe,ge)}const ve=T(de,[["render",he],["__scopeId","data-v-943f389e"]]);let D="";D="ws://localhost:8088/";location!=null&&location.protocol.includes("https")&&(D="wss"+D.slice(2));const $={appId:"G8CPjjcTqnNU4NjC",sessionId:"qbd4r6rahnxuazy5qoqd"};function ye(){}setInterval(ye,1e4);const U=e=>{const t=navigator.userAgent,a=/Chrome/.test(t)&&/Google Inc/.test(navigator.vendor),n=/Firefox/.test(t),o=/Trident/.test(t),s=/Edge/.test(t),c=/Safari/.test(t)&&/Apple Computer/.test(navigator.vendor),r=a*5+n*10+o*10+s*10+c*5||5;let u=1024*1024*r*.9;return new Blob([e]).size>u},Se=(e,t,a)=>{localStorage.setItem("token",e),localStorage.setItem("saveTokenTime",JSON.stringify(t)),localStorage.setItem("expiresIn",JSON.stringify(a))},j=()=>{const e="chatsList",t=localStorage.getItem(e);return t===null?[]:JSON.parse(t)},K=(e=[],t="chat-list")=>{W(e);try{localStorage.setItem(t,JSON.stringify(e))}catch(a){console.error("本地存储数据时出错：",a)}},W=(e=[])=>{const t=JSON.stringify(e);if(U(t))e.shift(),e.shift(),U(JSON.stringify(e))&&W(e);else return},we=()=>{if(!localStorage.getItem("token"))return!0;const e=JSON.parse(localStorage.getItem("saveTokenTime")),t=JSON.parse(localStorage.getItem("expiresIn"));return new Date().getTime()/1e3-e>t},A=v(0),Ie=e=>(A.value++,e.then(t=>(A.value--,t))),C=j(),B=C.findIndex(e=>e==null);console.log("🚀 ~ file: websocketChat.js:20 ~ x ~ x:",B,C.length);B>0&&(C.splice(B-1,2),K(C));let V=[{role:"system",content:"You are a professional front end assistant."}];C.forEach((e,t)=>{V=[...V,{role:"user",content:e.question},{role:"assistant",content:e.rep}]});const Y=[],Le=e=>{console.log("🚀 ~ file: index.js:26 ~ postOpenAi ~ request:",e,"time:"+new Date().toLocaleTimeString());let t=JSON.parse(JSON.stringify(V));Y.forEach((n,o)=>{t=[...t,{role:"user",content:n.question},{role:"assistant",content:n.rep}]}),t.push({role:"user",content:e});const a=t.length;return a>=7&&t.splice(1,a-5),X.post("https://api.openai.com/v1/chat/completions",{model:"gpt-3.5-turbo-0301",messages:t,temperature:0,n:1,user:"user"},{headers:{Authorization:`Bearer ${window.hhh_API_key.slice(0,-2)}`,"Content-Type":"application/json"}}).then(n=>{var c,r;let o=n.data;typeof o=="string"&&(o=JSON.parse(n.data)),console.log("🚀 ~ file: websocketChat.js:38 ~ postOpenAi ~ response:",typeof o,o);const s=(r=(c=o.choices[0])==null?void 0:c.message)==null?void 0:r.content;return t.push({role:"assistant",content:s}),s}).catch(n=>{const o=n==null?void 0:n.message;throw console.log("🚀 ~ file: index.js:75 ~ postOpenAi ~ er:",n),console.log("post api请求出错"),new Error(o)})},H=e=>(N("data-v-5ad8a09b"),e=e(),O(),e),be={class:"chat-list"},xe={class:"chat-item chat-item-user"},ke={class:"chat-item-rep mr-10 user"},Ee=H(()=>i("div",{class:"me square"},"我",-1)),Ce={class:"chat-item"},Te=H(()=>i("div",{class:"square"},"ai",-1)),qe={class:"chat-item-rep ml-10"},Ae={class:"submit-bottom"},Ne=P({__name:"ChatComponent",emits:["JLogin"],setup(e,{emit:t}){t("JLogin");const a=localStorage.getItem("sessionId");a?$.sessionId=a:($.sessionId=Z(),localStorage.setItem("sessionId",$.sessionId));const n=v("");let o=v(0),s=v([]);const c=q([]),r=v(null),u=v(null),f=()=>{let S="",g=n.value;const l=q({question:"",questionTime:"",rep:"",repTime:""});if(l.question=n.value,l.questionTime=new Date().toLocaleString(),n.value="",!g.trim())return;o.value=1,s.value=[...s.value,g,S],c.push(l);const w=Le(l.question);Ie(w).then(p=>{console.log("🚀 ~ file: ChatComponent.vue:42 ~ postOpenAi ~ res:",p),s.value[s.value.length-1]=p,l.rep=p,l.repTime=new Date().toLocaleString(),Y.push(l),console.log("🚀 ~ file: ChatComponent.vue:59 ~ useActionRequest ~ chatItem:",JSON.stringify(l)),o.value=0,z({message:"",type:"success"}),K(c,"chatsList")}),setTimeout(()=>{document.querySelector(".chat-item-scrollTo").scrollIntoView({behavior:"auto",block:"end",inline:"nearest"})})};ee(()=>{c.push(...j()),console.log("🚀 ~ file: ChatComponent.vue:76 ~ onBeforeMount ~ chatsList:",c)}),te(()=>{}),oe(()=>{r.value.scrollIntoView({behavior:"auto",block:"end",inline:"nearest"});var S=document.querySelectorAll(".submit-bottom");let g=0;document.querySelector(".chat-list").addEventListener("scroll",function(d){d.target.scrollTop<g,g=d.target.scrollTop,l(d.target)&&d.preventDefault()});function l(d){for(var I=0;I<S.length;I++)if(S[I].contains(d))return!0;return!1}document.addEventListener("touchmove",function(d){if(!l(d.target)){var I=document.activeElement;(I.tagName==="INPUT"||I.tagName==="TEXTAREA")&&I.blur()}});let w=!1;const p=document.querySelector(".chat-input");p.addEventListener("compositionstart",()=>{w=!0}),p.addEventListener("compositionend",d=>{w=!1}),p.addEventListener("keydown",d=>{d.key==="Enter"&&!w&&(d.preventDefault(),f())})});const y=()=>{o.value=0};return(S,g)=>{const l=F,w=M;return m(),h(J,null,[i("div",be,[(m(!0),h(J,null,se(c,(p,d)=>(m(),h("div",{key:d},[i("div",xe,[i("div",ke,x(p.question),1),Ee]),i("div",Ce,[Te,i("div",qe,[p.rep?k("",!0):(m(),G(ve,{key:0})),i("span",null,[E(x(p.rep),1),i("span",{class:re({"rep-light-cursor":d===b(s).length-1&&b(o)===2})},null,2)])])])]))),128)),i("div",{class:"chat-item-scrollTo",ref_key:"scrollToDom",ref:r},null,512)]),i("div",Ae,[ne(_(l,{type:"danger",round:"",class:"doneRep",onClick:y},{default:L(()=>[E("终止回答")]),_:1},512),[[ae,b(A)!==0]]),_(w,{ref_key:"qInoutEl",ref:u,class:"do-scrollbar-b chat-input",modelValue:n.value,"onUpdate:modelValue":g[0]||(g[0]=p=>n.value=p),autosize:{minRows:2,maxRows:4},type:"textarea",placeholder:"欢迎提问～"},null,8,["modelValue"]),_(l,{type:"primary",class:"ml-10 submit-btn",onClick:f},{default:L(()=>[E(x("提交")+" ")]),_:1})])],64)}}});const Oe=T(Ne,[["__scopeId","data-v-5ad8a09b"]]),Q=e=>(N("data-v-51ba3245"),e=e(),O(),e),$e={class:"login-box"},Je=Q(()=>i("div",{class:"login-title"}," ai chat登录 ",-1)),De=Q(()=>i("div",{class:"login-footer"},null,-1)),Be=P({__name:"Login",emits:["loginSuccess"],setup(e,{emit:t}){const a=q({username:"",password:""}),n=v(),o=q({username:[{required:!0,message:"请输入用户名",trigger:"blur"}],password:[{required:!0,message:"请输入密码",trigger:"blur"}]}),s=async r=>{r&&await r.validate((u,f)=>{if(u&&a.username==="huhaibiao")return c({success:!0,data:{token:1,expiresIn:2e4}})})},c=r=>{let u="登录成功",f,y;r.success?(u="登录成功",f="success",y=1e3,Se(r.data.token,new Date().getTime()/1e3,r.data.expiresIn),t("loginSuccess")):(u=r.msg,f="error",y=3e3),z({message:u,type:f,duration:y})};return(r,u)=>{const f=M,y=ie,S=F,g=le;return m(),h("div",$e,[Je,_(g,{ref_key:"ruleFormRef",ref:n,model:a,rules:o,style:{width:"100%"}},{default:L(()=>[_(y,{prop:"username"},{default:L(()=>[_(f,{modelValue:a.username,"onUpdate:modelValue":u[0]||(u[0]=l=>a.username=l),placeholder:"用户名",class:"div-box"},null,8,["modelValue"])]),_:1}),_(y,{prop:"password"},{default:L(()=>[_(f,{modelValue:a.password,"onUpdate:modelValue":u[1]||(u[1]=l=>a.password=l),type:"password",placeholder:"密码","show-password":"",class:"div-box"},null,8,["modelValue"])]),_:1}),_(S,{type:"primary",class:"div-box",onClick:u[2]||(u[2]=l=>s(n.value))},{default:L(()=>[E("登录")]),_:1})]),_:1},8,["model","rules"]),De])}}});const Ve=T(Be,[["__scopeId","data-v-51ba3245"]]);const Pe=e=>(N("data-v-cc953e34"),e=e(),O(),e),Fe={key:0,class:"development"},Re=Pe(()=>i("div",null,"开发环境",-1)),je={__name:"Developer",setup(e){const t=v("production");return(a,n)=>t.value==="development"?(m(),h("div",Fe,[Re,i("div",null,"ws连接状态："+x(),1),i("div",null,"正在请求中数："+x(b(A)),1)])):k("",!0)}},Ue=T(je,[["__scopeId","data-v-cc953e34"]]),ze=P({__name:"DownLoadChatsList",setup(e){function t(n,o){const s=document.createElement("a"),c=new Blob([o]),r=document.createEvent("MouseEvents");r.initEvent("click",!1,!1),s.download=n,s.href=URL.createObjectURL(c),s.type="log",s.dispatchEvent(r),navigator.userAgent.indexOf("Firefox")>=0&&s.click()}const a=n=>{const o=j();t("ai-chat-history",JSON.stringify(o))};return(n,o)=>{const s=F;return m(),G(s,{type:"primary",plain:"",onClick:a},{default:L(()=>[E("导出所有对话")]),_:1})}}});const Me={key:0,class:"exp-chat-list"},Ge={key:1,style:{width:"100%",height:"100%"},class:"chat-component"},Ke={key:2,class:"login"},We={__name:"App",setup(e){let t=v(!0);const a=()=>{t.value=we()};return a(),(n,o)=>(m(),h(J,null,[b(t)?k("",!0):(m(),h("div",Me,[_(ze)])),_(Ue),b(t)?k("",!0):(m(),h("div",Ge,[_(Oe,{onJLogin:a})])),b(t)?(m(),h("div",Ke,[_(Ve,{onLoginSuccess:o[0]||(o[0]=s=>ce(t)?t.value=!1:t=!1)})])):k("",!0)],64))}},Ye=T(We,[["__scopeId","data-v-39380d36"]]),He=ue(Ye);He.mount("#app");window.hhh_API_key="sk-FgnukWr2hBBYdU6cQ9EKT3BlbkFJgKprcmS7ESlZ6JqP3GGshh";window.__APP_ENV__="production";console.log(window.__APP_ENV__,!1);
