import{o as m,c as w,p as j,a as B,b as u,r as h,d as ce,e as N,v as re,f as D,g as ue,h as de,i as K,F as J,j as W,w as pe,k as _e,u as E,l as d,m as _,n as x,t as L,E as Z,q as Y,s as ee,x as te,y as A,z as T,A as Q,B as me,C as fe,D as he,G as ve,H as ge,I as ye,J as we,K as Se,L as be,M as Le}from"./vendor-95c0c482.js";(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))n(o);new MutationObserver(o=>{for(const l of o)if(l.type==="childList")for(const a of l.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&n(a)}).observe(document,{childList:!0,subtree:!0});function s(o){const l={};return o.integrity&&(l.integrity=o.integrity),o.referrerPolicy&&(l.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?l.credentials="include":o.crossOrigin==="anonymous"?l.credentials="omit":l.credentials="same-origin",l}function n(o){if(o.ep)return;o.ep=!0;const l=s(o);fetch(o.href,l)}})();const V=(e,t)=>{const s=e.__vccOpts||e;for(const[n,o]of t)s[n]=o;return s},Ie={},X=e=>(j("data-v-943f389e"),e=e(),B(),e),xe={class:"loading"},ke=X(()=>u("div",{class:"point an-point"},null,-1)),Ce=X(()=>u("div",{class:"point an-point"},null,-1)),Ee=X(()=>u("div",{class:"point an-point"},null,-1)),qe=[ke,Ce,Ee];function Ve(e,t){return m(),w("div",xe,qe)}const Ae=V(Ie,[["render",Ve],["__scopeId","data-v-943f389e"]]);let z="";z="ws://localhost:8088/";location!=null&&location.protocol.includes("https")&&(z="wss"+z.slice(2));const F={appId:"G8CPjjcTqnNU4NjC",sessionId:"qbd4r6rahnxuazy5qoqd"};function Te(){}setInterval(Te,1e4);const G=e=>{const t=navigator.userAgent,s=/Chrome/.test(t)&&/Google Inc/.test(navigator.vendor),n=/Firefox/.test(t),o=/Trident/.test(t),l=/Edge/.test(t),a=/Safari/.test(t)&&/Apple Computer/.test(navigator.vendor),r=s*5+n*10+o*10+l*10+a*5||5;let i=1024*1024*r*.9;return new Blob([e]).size>i},$e=(e,t,s)=>{localStorage.setItem("token",e),localStorage.setItem("saveTokenTime",JSON.stringify(t)),localStorage.setItem("expiresIn",JSON.stringify(s))};let P;const R=()=>{const e="chatsList";return P=localStorage.getItem(e),P===null?[]:JSON.parse(P)},oe=(e=[],t="chat-list")=>{se(e);try{localStorage.setItem(t,JSON.stringify(e))}catch(s){console.error("本地存储数据时出错：",s)}},se=(e=[])=>{const t=JSON.stringify(e);if(G(t))e.shift(),e.shift(),G(JSON.stringify(e))&&se(e);else return},Ne=()=>{if(!localStorage.getItem("token"))return!0;const e=JSON.parse(localStorage.getItem("saveTokenTime")),t=JSON.parse(localStorage.getItem("expiresIn"));return new Date().getTime()/1e3-e>t},Oe=(e,t)=>{let s,n;e.addEventListener("touchstart",function(o){s=o.touches[0].clientX,n=o.touches[0].clientY}),e.addEventListener("touchmove",function(o){const l=o.touches[0].clientX-s,a=o.touches[0].clientY-n;Math.abs(l)>Math.abs(a)?l<-80?(console.log("向左滑动"),t()):console.log("向右滑动"):a<0?console.log("向上滑动"):console.log("向下滑动")}),e.addEventListener("touchend",function(o){s=null,n=null})};function De(){const e=navigator.userAgent.toLowerCase(),t=["android","iphone","ipod","ipad","windows phone","blackberry","mobile"];for(let s=0;s<t.length;s++)if(e.indexOf(t[s])!==-1)return!0;return!1}const Je=(e,t)=>{e.addEventListener("contextmenu",function(s){console.log(window.getSelection().toString()),t()})},U=h(0),Ue=e=>(U.value++,e.then(t=>(U.value--,t))),$=R(),M=$.findIndex(e=>e==null);console.log("🚀 ~ file: websocketChat.js:20 ~ x ~ x:",M,$.length);M>0&&($.splice(M-1,2),oe($));let H=[{role:"system",content:"You are a professional front end assistant."}];$.forEach((e,t)=>{H=[...H,{role:"user",content:e.question},{role:"assistant",content:e.rep}]});const ne=[],je=e=>{console.log("🚀 ~ file: index.js:26 ~ postOpenAi ~ request:",e,"time:"+new Date().toLocaleTimeString());let t=JSON.parse(JSON.stringify(H));ne.forEach((n,o)=>{t=[...t,{role:"user",content:n.question},{role:"assistant",content:n.rep}]}),t.push({role:"user",content:e});const s=t.length;return s>=7&&t.splice(1,s-4),ce.post("https://api.openai.com/v1/chat/completions",{model:"gpt-3.5-turbo-0301",messages:t,temperature:.6,n:1,user:"user"},{headers:{Authorization:`Bearer ${window.hhh_API_key.slice(0,-2)}`,"Content-Type":"application/json"},withCredentials:!1}).then(n=>{var a,r;let o=n.data;typeof o=="string"&&(o=JSON.parse(n.data)),console.log("🚀 ~ file: websocketChat.js:38 ~ postOpenAi ~ response:",typeof o,o);const l=(r=(a=o.choices[0])==null?void 0:a.message)==null?void 0:r.content;return t.push({role:"assistant",content:l}),l}).catch(n=>{const o=n==null?void 0:n.message;throw console.log("🚀 ~ file: index.js:75 ~ postOpenAi ~ er:",n),console.log("post api请求出错"),new Error(o)})},le=e=>(j("data-v-cc23fc39"),e=e(),B(),e),Be={class:"chat-list"},Re={class:"chat-item chat-item-user",style:{position:"relative"}},Fe={class:"chat-item-rep mr-10 user"},Pe=le(()=>u("div",{class:"me square"},"我",-1)),ze={class:"time",style:{position:"absolute",bottom:"-25px",right:"50px"}},Me={class:"chat-item",style:{position:"relative"}},He=le(()=>u("div",{class:"square"},"ai",-1)),Ye={class:"chat-item-rep ml-10"},Xe={class:"time",style:{position:"absolute",bottom:"-25px",left:"50px"}},Qe={class:"submit-bottom"},Ge={style:{"word-wrap":"break-word"}},Ke={class:"dialog-footer"},We=N({__name:"ChatComponent",emits:["JLogin"],setup(e,{emit:t}){t("JLogin");let s=-1;const n=localStorage.getItem("sessionId");n?F.sessionId=n:(F.sessionId=re(),localStorage.setItem("sessionId",F.sessionId));const o=h("");let l=h(0);const a=D([]),r=h(null),i=h(null),f=q=>{let v=o.value;q&&(v=q);const g=D({question:"",questionTime:"",rep:"",repTime:""});if(g.question=v,g.questionTime=new Date().toLocaleString(),o.value="",!v.trim())return;l.value=1,s!==-1?(a.splice(s+1,0,g),s=-1):a.push(g);const I=je(g.question);Ue(I).then(k=>{console.log("🚀 ~ file: ChatComponent.vue:42 ~ postOpenAi ~ res:",k),g.rep=k,g.repTime=new Date().toLocaleString(),ne.push(g),console.log("🚀 ~ file: ChatComponent.vue:59 ~ useActionRequest ~ chatItem:",JSON.stringify(g)),l.value=0,Z({message:"",type:"success"}),oe(a,"chatsList")}),setTimeout(()=>{document.querySelector(".chat-item-scrollTo").scrollIntoView({behavior:"auto",block:"end",inline:"nearest"})})};ue(()=>{a.push(...R()),console.log("🚀 ~ file: ChatComponent.vue:76 ~ onBeforeMount ~ chatsList:",a)}),de(()=>{}),K(()=>{var O;r.value.scrollIntoView({behavior:"auto",block:"end",inline:"nearest"});var q=document.querySelectorAll(".submit-bottom");let v=0;document.querySelector(".chat-list").addEventListener("scroll",function(c){c.target.scrollTop<v,v=c.target.scrollTop,g(c.target)&&c.preventDefault()});function g(c){for(var y=0;y<q.length;y++)if(q[y].contains(c))return!0;return!1}document.addEventListener("touchmove",function(c){if(!g(c.target)){var y=document.activeElement;(y.tagName==="INPUT"||y.tagName==="TEXTAREA")&&y.blur()}});let I=!1;const k=document.querySelector(".chat-input");k.addEventListener("compositionstart",()=>{I=!0}),k.addEventListener("compositionend",c=>{I=!1}),k.addEventListener("keydown",c=>{c.key==="Enter"&&!I&&(c.preventDefault(),f())}),(O=document.querySelector(".chat-list"))==null||O.addEventListener("mousedown",c=>{var y;s=+((y=c.target)==null?void 0:y.getAttribute("class"))}),Je(document.querySelector(".chat-list"),C)});const b=()=>{l.value=0},C=()=>{p.value=!0,S.value=window.getSelection().toString()},p=h(!1),S=h(""),ie=()=>{p.value=!1,f(S.value)};return(q,v)=>{const g=me,I=Y,k=ee,O=te;return m(),w(J,null,[u("div",Be,[(m(!0),w(J,null,W(a,(c,y)=>(m(),w("div",{key:y},[u("div",Re,[u("div",Fe,L(c.question),1),Pe,u("div",ze,[d(g,{type:"info",size:"small"},{default:_(()=>[x(L("时间:"+c.questionTime),1)]),_:2},1024)])]),u("div",Me,[He,u("div",Ye,[c.rep?T("",!0):(m(),A(Ae,{key:0})),(m(),w("span",{class:Q(y+""),key:y},[x(L(c.rep),1),u("span",{class:Q({"rep-light-cursor":y===a.length-1&&E(l)===2})},null,2)],2))]),u("div",Xe,[d(g,{type:"info",size:"small"},{default:_(()=>[x(L("时间:"+c.repTime),1)]),_:2},1024)])])]))),128)),u("div",{class:"chat-item-scrollTo",ref_key:"scrollToDom",ref:r},null,512)]),u("div",Qe,[pe(d(I,{type:"danger",round:"",class:"doneRep",onClick:b},{default:_(()=>[x("终止回答")]),_:1},512),[[_e,E(U)!==0]]),d(k,{ref_key:"qInoutEl",ref:i,class:"do-scrollbar-b chat-input",modelValue:o.value,"onUpdate:modelValue":v[0]||(v[0]=c=>o.value=c),autosize:{minRows:2,maxRows:4},type:"textarea",placeholder:"欢迎提问～"},null,8,["modelValue"]),d(I,{type:"primary",class:"ml-10 submit-btn",onClick:f},{default:_(()=>[x(L("提交")+" ")]),_:1})]),d(O,{modelValue:p.value,"onUpdate:modelValue":v[3]||(v[3]=c=>p.value=c),width:"70%",center:""},{footer:_(()=>[u("span",Ke,[d(I,{onClick:v[2]||(v[2]=c=>p.value=!1)},{default:_(()=>[x("取消")]),_:1}),d(I,{type:"primary",onClick:ie},{default:_(()=>[x(" 提交 ")]),_:1})])]),default:_(()=>[d(k,{modelValue:S.value,"onUpdate:modelValue":v[1]||(v[1]=c=>S.value=c),placeholder:"Please input"},null,8,["modelValue"]),u("div",Ge,L(S.value),1)]),_:1},8,["modelValue"])],64)}}});const Ze=V(We,[["__scopeId","data-v-cc23fc39"]]),ae=e=>(j("data-v-5ee62532"),e=e(),B(),e),et={class:"login-box"},tt=ae(()=>u("div",{class:"login-title"}," ai chat登录 ",-1)),ot=ae(()=>u("div",{class:"login-footer"},null,-1)),st=N({__name:"Login",emits:["loginSuccess"],setup(e,{emit:t}){const s=D({username:"",password:""}),n=h(),o=D({username:[{required:!0,message:"请输入用户名",trigger:"blur"}],password:[{required:!0,message:"请输入密码",trigger:"blur"}]}),l=async r=>{r&&await r.validate((i,f)=>{if(i&&s.username==="huhaibiao")return a({success:!0,data:{token:1,expiresIn:2e5}})})},a=r=>{let i="登录成功",f,b;r.success?(i="登录成功",f="success",b=1e3,$e(r.data.token,new Date().getTime()/1e3,r.data.expiresIn),t("loginSuccess")):(i=r.msg,f="error",b=3e3),Z({message:i,type:f,duration:b})};return(r,i)=>{const f=ee,b=he,C=Y,p=fe;return m(),w("div",et,[tt,d(p,{ref_key:"ruleFormRef",ref:n,model:s,rules:o,style:{width:"100%"}},{default:_(()=>[d(b,{prop:"username"},{default:_(()=>[d(f,{modelValue:s.username,"onUpdate:modelValue":i[0]||(i[0]=S=>s.username=S),placeholder:"用户名",class:"div-box"},null,8,["modelValue"])]),_:1}),d(b,{prop:"password"},{default:_(()=>[d(f,{modelValue:s.password,"onUpdate:modelValue":i[1]||(i[1]=S=>s.password=S),type:"password",placeholder:"密码","show-password":"",class:"div-box"},null,8,["modelValue"])]),_:1}),d(C,{type:"primary",class:"div-box",onClick:i[2]||(i[2]=S=>l(n.value))},{default:_(()=>[x("登录")]),_:1})]),_:1},8,["model","rules"]),ot])}}});const nt=V(st,[["__scopeId","data-v-5ee62532"]]);const lt=e=>(j("data-v-cc953e34"),e=e(),B(),e),at={key:0,class:"development"},it=lt(()=>u("div",null,"开发环境",-1)),ct={__name:"Developer",setup(e){const t=h("production");return(s,n)=>t.value==="development"?(m(),w("div",at,[it,u("div",null,"ws连接状态："+L(),1),u("div",null,"正在请求中数："+L(E(U)),1)])):T("",!0)}},rt=V(ct,[["__scopeId","data-v-cc953e34"]]),ut=N({__name:"DownLoadChatsList",setup(e){function t(n,o){const l=document.createElement("a"),a=new Blob([o]),r=URL.createObjectURL(a);l.href=r,l.download=n+".json",document.body.appendChild(l),l.click(),document.body.removeChild(l),URL.revokeObjectURL(r)}const s=n=>{const o=R();t("ai-chat-history",JSON.stringify(o))};return(n,o)=>{const l=Y;return m(),A(l,{type:"primary",plain:"",onClick:s},{default:_(()=>[x("导出所有对话")]),_:1})}}}),dt={key:1},pt=N({__name:"QuestList",emits:["change"],setup(e,{emit:t}){const s=h(R()),n=h(),o=r=>{t("change",r,s.value[r])},l=De(),a=h(l);return(r,i)=>{const f=ge,b=ye,C=ve;return m(),A(C,{modelValue:n.value,"onUpdate:modelValue":i[0]||(i[0]=p=>n.value=p),placeholder:"打开问题列表",onChange:o},{default:_(()=>[(m(!0),w(J,null,W(s.value,(p,S)=>(m(),A(b,{class:"option",key:S,label:p.question,value:S},{default:_(()=>[a.value?(m(),w("div",dt,L(p.question),1)):(m(),A(f,{key:0,class:"box-item",effect:"dark",content:p.question,"hide-after":0,placement:"top"},{default:_(()=>[x(L(p.question),1)]),_:2},1032,["content"]))]),_:2},1032,["label","value"]))),128))]),_:1},8,["modelValue"])}}});const _t=V(pt,[["__scopeId","data-v-51f5a98f"]]),mt={viewBox:"0 0 1024 1024",width:"1.2em",height:"1.2em"},ft=u("path",{fill:"currentColor",d:"M926.784 480H701.312A192.512 192.512 0 0 0 544 322.688V97.216A416.064 416.064 0 0 1 926.784 480zm0 64A416.064 416.064 0 0 1 544 926.784V701.312A192.512 192.512 0 0 0 701.312 544h225.472zM97.28 544h225.472A192.512 192.512 0 0 0 480 701.312v225.472A416.064 416.064 0 0 1 97.216 544zm0-64A416.064 416.064 0 0 1 480 97.216v225.472A192.512 192.512 0 0 0 322.688 480H97.216z"},null,-1),ht=[ft];function vt(e,t){return m(),w("svg",mt,ht)}const gt={name:"ep-HelpFilled",render:vt},yt={key:0,class:"exp-chat-list"},wt={style:{"white-space":"pre-wrap"}},St={key:1,style:{width:"100%",height:"100%"},class:"chat-component"},bt={key:2,class:"login"},Lt=N({__name:"App",setup(e){let t=h(!0);const s=()=>{t.value=Ne()};s();const n=h({question:"",rep:""}),o=h(!1),l=(r,i)=>{n.value=i,o.value=!0},a=h(!1);return K(()=>{Oe(document,()=>a.value=!0)}),(r,i)=>{const f=Se,b=be,C=te;return m(),w(J,null,[E(t)?T("",!0):(m(),w("div",yt,[d(f,{size:30,style:{"margin-top":"10px",cursor:"pointer"},color:"#409EFC",onClick:i[0]||(i[0]=p=>a.value=!a.value)},{default:_(()=>[d(E(gt))]),_:1}),d(b,{modelValue:a.value,"onUpdate:modelValue":i[1]||(i[1]=p=>a.value=p),title:"I am the title","with-header":!1,size:"220"},{default:_(()=>[d(ut),d(_t,{style:{"margin-top":"10px"},onChange:l})]),_:1},8,["modelValue"])])),d(C,{modelValue:o.value,"onUpdate:modelValue":i[2]||(i[2]=p=>o.value=p),title:n.value.question,width:"80%"},{default:_(()=>[u("div",wt,L(n.value.rep),1)]),_:1},8,["modelValue","title"]),d(rt),E(t)?T("",!0):(m(),w("div",St,[d(Ze,{onJLogin:s})])),E(t)?(m(),w("div",bt,[d(nt,{onLoginSuccess:i[3]||(i[3]=p=>we(t)?t.value=!1:t=!1)})])):T("",!0)],64)}}});const It=V(Lt,[["__scopeId","data-v-f163f76e"]]),xt=Le(It);xt.mount("#app");window.hhh_API_key="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";window.__APP_ENV__="production";console.log(window.__APP_ENV__,!1);
