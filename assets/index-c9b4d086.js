import{o as h,c as y,p as O,a as N,b as c,r as v,d as ee,e as U,v as te,f as T,g as oe,h as se,i as ne,F as B,j as le,w as ie,k as ae,u as I,l as _,m as w,n as k,t as x,E as G,q as j,s as K,x as q,y as C,z as re,A as ce,B as ue,C as de,D as pe,G as _e,H as me,I as he,J as fe}from"./vendor-8d99a02c.js";(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))l(o);new MutationObserver(o=>{for(const s of o)if(s.type==="childList")for(const a of s.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&l(a)}).observe(document,{childList:!0,subtree:!0});function n(o){const s={};return o.integrity&&(s.integrity=o.integrity),o.referrerPolicy&&(s.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?s.credentials="include":o.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function l(o){if(o.ep)return;o.ep=!0;const s=n(o);fetch(o.href,s)}})();const ge="modulepreload",ve=function(e,t){return new URL(e,t).href},H={},ye=function(t,n,l){if(!n||n.length===0)return t();const o=document.getElementsByTagName("link");return Promise.all(n.map(s=>{if(s=ve(s,l),s in H)return;H[s]=!0;const a=s.endsWith(".css"),r=a?'[rel="stylesheet"]':"";if(!!l)for(let m=o.length-1;m>=0;m--){const f=o[m];if(f.href===s&&(!a||f.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${s}"]${r}`))return;const i=document.createElement("link");if(i.rel=a?"stylesheet":ge,a||(i.as="script",i.crossOrigin=""),i.href=s,document.head.appendChild(i),a)return new Promise((m,f)=>{i.addEventListener("load",m),i.addEventListener("error",()=>f(new Error(`Unable to preload CSS for ${s}`)))})})).then(()=>t())};const A=(e,t)=>{const n=e.__vccOpts||e;for(const[l,o]of t)n[l]=o;return n},we={},F=e=>(O("data-v-943f389e"),e=e(),N(),e),Se={class:"loading"},Le=F(()=>c("div",{class:"point an-point"},null,-1)),Ie=F(()=>c("div",{class:"point an-point"},null,-1)),be=F(()=>c("div",{class:"point an-point"},null,-1)),xe=[Le,Ie,be];function ke(e,t){return h(),y("div",Se,xe)}const Ce=A(we,[["render",ke],["__scopeId","data-v-943f389e"]]);let J="";J="ws://localhost:8088/";location!=null&&location.protocol.includes("https")&&(J="wss"+J.slice(2));const V={appId:"G8CPjjcTqnNU4NjC",sessionId:"qbd4r6rahnxuazy5qoqd"};function Ee(){}setInterval(Ee,1e4);const M=e=>{const t=navigator.userAgent,n=/Chrome/.test(t)&&/Google Inc/.test(navigator.vendor),l=/Firefox/.test(t),o=/Trident/.test(t),s=/Edge/.test(t),a=/Safari/.test(t)&&/Apple Computer/.test(navigator.vendor),r=n*5+l*10+o*10+s*10+a*5||5;let d=1024*1024*r*.9;return new Blob([e]).size>d},Ae=(e,t,n)=>{localStorage.setItem("token",e),localStorage.setItem("saveTokenTime",JSON.stringify(t)),localStorage.setItem("expiresIn",JSON.stringify(n))};let R;const z=()=>{const e="chatsList";return R=localStorage.getItem(e),R===null?[]:JSON.parse(R)},W=(e=[],t="chat-list")=>{Q(e);try{localStorage.setItem(t,JSON.stringify(e))}catch(n){console.error("本地存储数据时出错：",n)}},Q=(e=[])=>{const t=JSON.stringify(e);if(M(t))e.shift(),e.shift(),M(JSON.stringify(e))&&Q(e);else return},Te=()=>{if(!localStorage.getItem("token"))return!0;const e=JSON.parse(localStorage.getItem("saveTokenTime")),t=JSON.parse(localStorage.getItem("expiresIn"));return new Date().getTime()/1e3-e>t},$=v(0),qe=e=>($.value++,e.then(t=>($.value--,t))),E=z(),D=E.findIndex(e=>e==null);console.log("🚀 ~ file: websocketChat.js:20 ~ x ~ x:",D,E.length);D>0&&(E.splice(D-1,2),W(E));let P=[{role:"system",content:"You are a professional front end assistant."}];E.forEach((e,t)=>{P=[...P,{role:"user",content:e.question},{role:"assistant",content:e.rep}]});const Y=[],$e=e=>{console.log("🚀 ~ file: index.js:26 ~ postOpenAi ~ request:",e,"time:"+new Date().toLocaleTimeString());let t=JSON.parse(JSON.stringify(P));Y.forEach((l,o)=>{t=[...t,{role:"user",content:l.question},{role:"assistant",content:l.rep}]}),t.push({role:"user",content:e});const n=t.length;return n>=7&&t.splice(1,n-5),ee.post("https://api.openai.com/v1/chat/completions",{model:"gpt-3.5-turbo-0301",messages:t,temperature:0,n:1,user:"user"},{headers:{Authorization:`Bearer ${window.hhh_API_key.slice(0,-2)}`,"Content-Type":"application/json"}}).then(l=>{var a,r;let o=l.data;typeof o=="string"&&(o=JSON.parse(l.data)),console.log("🚀 ~ file: websocketChat.js:38 ~ postOpenAi ~ response:",typeof o,o);const s=(r=(a=o.choices[0])==null?void 0:a.message)==null?void 0:r.content;return t.push({role:"assistant",content:s}),s}).catch(l=>{const o=l==null?void 0:l.message;throw console.log("🚀 ~ file: index.js:75 ~ postOpenAi ~ er:",l),console.log("post api请求出错"),new Error(o)})},X=e=>(O("data-v-556ae7c0"),e=e(),N(),e),Oe={class:"chat-list"},Ne={class:"chat-item chat-item-user",style:{position:"relative"}},Ve={class:"chat-item-rep mr-10 user"},Re=X(()=>c("div",{class:"me square"},"我",-1)),Be={class:"time",style:{position:"absolute",bottom:"-25px",right:"50px"}},Je={class:"chat-item",style:{position:"relative"}},De=X(()=>c("div",{class:"square"},"ai",-1)),Pe={class:"chat-item-rep ml-10"},Ue={class:"time",style:{position:"absolute",bottom:"-25px",left:"50px"}},je={class:"submit-bottom"},Fe=U({__name:"ChatComponent",emits:["JLogin"],setup(e,{emit:t}){t("JLogin");const n=localStorage.getItem("sessionId");n?V.sessionId=n:(V.sessionId=te(),localStorage.setItem("sessionId",V.sessionId));const l=v("");let o=v(0),s=v([]);const a=T([]),r=v(null),d=v(null),i=()=>{let f="",g=l.value;const p=T({question:"",questionTime:"",rep:"",repTime:""});if(p.question=l.value,p.questionTime=new Date().toLocaleString(),l.value="",!g.trim())return;o.value=1,s.value=[...s.value,g,f],a.push(p);const b=$e(p.question);qe(b).then(L=>{console.log("🚀 ~ file: ChatComponent.vue:42 ~ postOpenAi ~ res:",L),s.value[s.value.length-1]=L,p.rep=L,p.repTime=new Date().toLocaleString(),Y.push(p),console.log("🚀 ~ file: ChatComponent.vue:59 ~ useActionRequest ~ chatItem:",JSON.stringify(p)),o.value=0,G({message:"",type:"success"}),W(a,"chatsList")}),setTimeout(()=>{document.querySelector(".chat-item-scrollTo").scrollIntoView({behavior:"auto",block:"end",inline:"nearest"})})};oe(()=>{a.push(...z()),console.log("🚀 ~ file: ChatComponent.vue:76 ~ onBeforeMount ~ chatsList:",a)}),se(()=>{}),ne(()=>{r.value.scrollIntoView({behavior:"auto",block:"end",inline:"nearest"});var f=document.querySelectorAll(".submit-bottom");let g=0;document.querySelector(".chat-list").addEventListener("scroll",function(u){u.target.scrollTop<g,g=u.target.scrollTop,p(u.target)&&u.preventDefault()});function p(u){for(var S=0;S<f.length;S++)if(f[S].contains(u))return!0;return!1}document.addEventListener("touchmove",function(u){if(!p(u.target)){var S=document.activeElement;(S.tagName==="INPUT"||S.tagName==="TEXTAREA")&&S.blur()}});let b=!1;const L=document.querySelector(".chat-input");L.addEventListener("compositionstart",()=>{b=!0}),L.addEventListener("compositionend",u=>{b=!1}),L.addEventListener("keydown",u=>{u.key==="Enter"&&!b&&(u.preventDefault(),i())})});const m=()=>{o.value=0};return(f,g)=>{const p=ce,b=j,L=K;return h(),y(B,null,[c("div",Oe,[(h(!0),y(B,null,le(a,(u,S)=>(h(),y("div",{key:S},[c("div",Ne,[c("div",Ve,x(u.question),1),Re,c("div",Be,[_(p,{type:"info",size:"small"},{default:w(()=>[k(x("时间:"+u.questionTime),1)]),_:2},1024)])]),c("div",Je,[De,c("div",Pe,[u.rep?C("",!0):(h(),q(Ce,{key:0})),c("span",null,[k(x(u.rep),1),c("span",{class:re({"rep-light-cursor":S===I(s).length-1&&I(o)===2})},null,2)])]),c("div",Ue,[_(p,{type:"info",size:"small"},{default:w(()=>[k(x("时间:"+u.repTime),1)]),_:2},1024)])])]))),128)),c("div",{class:"chat-item-scrollTo",ref_key:"scrollToDom",ref:r},null,512)]),c("div",je,[ie(_(b,{type:"danger",round:"",class:"doneRep",onClick:m},{default:w(()=>[k("终止回答")]),_:1},512),[[ae,I($)!==0]]),_(L,{ref_key:"qInoutEl",ref:d,class:"do-scrollbar-b chat-input",modelValue:l.value,"onUpdate:modelValue":g[0]||(g[0]=u=>l.value=u),autosize:{minRows:2,maxRows:4},type:"textarea",placeholder:"欢迎提问～"},null,8,["modelValue"]),_(b,{type:"primary",class:"ml-10 submit-btn",onClick:i},{default:w(()=>[k(x("提交")+" ")]),_:1})])],64)}}});const ze=A(Fe,[["__scopeId","data-v-556ae7c0"]]),Z=e=>(O("data-v-51ba3245"),e=e(),N(),e),He={class:"login-box"},Me=Z(()=>c("div",{class:"login-title"}," ai chat登录 ",-1)),Ge=Z(()=>c("div",{class:"login-footer"},null,-1)),Ke=U({__name:"Login",emits:["loginSuccess"],setup(e,{emit:t}){const n=T({username:"",password:""}),l=v(),o=T({username:[{required:!0,message:"请输入用户名",trigger:"blur"}],password:[{required:!0,message:"请输入密码",trigger:"blur"}]}),s=async r=>{r&&await r.validate((d,i)=>{if(d&&n.username==="huhaibiao")return a({success:!0,data:{token:1,expiresIn:2e4}})})},a=r=>{let d="登录成功",i,m;r.success?(d="登录成功",i="success",m=1e3,Ae(r.data.token,new Date().getTime()/1e3,r.data.expiresIn),t("loginSuccess")):(d=r.msg,i="error",m=3e3),G({message:d,type:i,duration:m})};return(r,d)=>{const i=K,m=ue,f=j,g=de;return h(),y("div",He,[Me,_(g,{ref_key:"ruleFormRef",ref:l,model:n,rules:o,style:{width:"100%"}},{default:w(()=>[_(m,{prop:"username"},{default:w(()=>[_(i,{modelValue:n.username,"onUpdate:modelValue":d[0]||(d[0]=p=>n.username=p),placeholder:"用户名",class:"div-box"},null,8,["modelValue"])]),_:1}),_(m,{prop:"password"},{default:w(()=>[_(i,{modelValue:n.password,"onUpdate:modelValue":d[1]||(d[1]=p=>n.password=p),type:"password",placeholder:"密码","show-password":"",class:"div-box"},null,8,["modelValue"])]),_:1}),_(f,{type:"primary",class:"div-box",onClick:d[2]||(d[2]=p=>s(l.value))},{default:w(()=>[k("登录")]),_:1})]),_:1},8,["model","rules"]),Ge])}}});const We=A(Ke,[["__scopeId","data-v-51ba3245"]]);const Qe=e=>(O("data-v-cc953e34"),e=e(),N(),e),Ye={key:0,class:"development"},Xe=Qe(()=>c("div",null,"开发环境",-1)),Ze={__name:"Developer",setup(e){const t=v("production");return(n,l)=>t.value==="development"?(h(),y("div",Ye,[Xe,c("div",null,"ws连接状态："+x(),1),c("div",null,"正在请求中数："+x(I($)),1)])):C("",!0)}},et=A(Ze,[["__scopeId","data-v-cc953e34"]]),tt=U({__name:"DownLoadChatsList",setup(e){function t(l,o){const s=document.createElement("a"),a=new Blob([o]),r=URL.createObjectURL(a);s.href=r,s.download=l+".json",document.body.appendChild(s),s.click(),document.body.removeChild(s),URL.revokeObjectURL(r)}const n=l=>{const o=z();t("ai-chat-history",JSON.stringify(o))};return(l,o)=>{const s=j;return h(),q(s,{type:"primary",plain:"",onClick:n},{default:w(()=>[k("导出所有对话")]),_:1})}}}),ot={viewBox:"0 0 1024 1024",width:"1.2em",height:"1.2em"},st=c("path",{fill:"currentColor",d:"M926.784 480H701.312A192.512 192.512 0 0 0 544 322.688V97.216A416.064 416.064 0 0 1 926.784 480zm0 64A416.064 416.064 0 0 1 544 926.784V701.312A192.512 192.512 0 0 0 701.312 544h225.472zM97.28 544h225.472A192.512 192.512 0 0 0 480 701.312v225.472A416.064 416.064 0 0 1 97.216 544zm0-64A416.064 416.064 0 0 1 480 97.216v225.472A192.512 192.512 0 0 0 322.688 480H97.216z"},null,-1),nt=[st];function lt(e,t){return h(),y("svg",ot,nt)}const it={name:"ep-HelpFilled",render:lt};const at={key:0,class:"exp-chat-list"},rt={style:{"white-space":"pre-wrap"}},ct={key:1,style:{width:"100%",height:"100%"},class:"chat-component"},ut={key:2,class:"login"},dt={__name:"App",setup(e){const t=pe(()=>ye(()=>import("./QuestList-f05aa2b7.js"),["./QuestList-f05aa2b7.js","./vendor-8d99a02c.js","./vendor-a71a3d74.css","./QuestList-50f61d91.css"],import.meta.url));let n=v(!0);const l=()=>{n.value=Te()};l();const o=v({}),s=v(!1),a=(d,i)=>{o.value=i,s.value=!0},r=v(!1);return(d,i)=>{const m=me,f=he;return h(),y(B,null,[I(n)?C("",!0):(h(),y("div",at,[_(m,{size:30,style:{margin:"10px"},onClick:i[0]||(i[0]=g=>r.value=!r.value)},{default:w(()=>[_(I(it))]),_:1}),r.value?(h(),q(tt,{key:0})):C("",!0),r.value?(h(),q(I(t),{key:1,style:{"margin-top":"10px"},onChange:a})):C("",!0)])),_(f,{modelValue:s.value,"onUpdate:modelValue":i[1]||(i[1]=g=>s.value=g),title:o.value.question,width:"80%"},{default:w(()=>[c("div",rt,x(o.value.rep),1)]),_:1},8,["modelValue","title"]),_(et),I(n)?C("",!0):(h(),y("div",ct,[_(ze,{onJLogin:l})])),I(n)?(h(),y("div",ut,[_(We,{onLoginSuccess:i[2]||(i[2]=g=>_e(n)?n.value=!1:n=!1)})])):C("",!0)],64)}}},pt=A(dt,[["__scopeId","data-v-9cdcb69d"]]),_t=fe(pt);_t.mount("#app");window.hhh_API_key="sk-FgnukWr2hBBYdU6cQ9EKT3BlbkFJgKprcmS7ESlZ6JqP3GGshh";window.__APP_ENV__="production";console.log(window.__APP_ENV__,!1);export{A as _,z as g};
